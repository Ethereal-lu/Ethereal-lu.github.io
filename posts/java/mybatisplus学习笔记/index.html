<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MyBatisPlus学习笔记 | lu</title>
<meta name=keywords content><meta name=description content="1、快速开始
1.1、导入依赖
mybatis 和 mybatis-plus 的依赖不要同时导入。
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter</artifactId>
    </dependency>

    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <scope>runtime</scope>
    </dependency>
    <dependency>
        <groupId>com.baomidou</groupId>
        <artifactId>mybatis-plus-boot-starter</artifactId>
        <version>3.4.3</version>
    </dependency>
    <dependency>
        <groupId>com.baomidou</groupId>
        <artifactId>mybatis-plus-core</artifactId>
        <version>3.4.3</version>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
1.2、配置
在主yaml中配置和 mybatis 的完全一样，没其他配置。
1.3、使用
@Repository
public interface UserMapper extends BaseMapper<User> {
}
UserMapper 接口只需继承 BaseMapper ，其中泛型填入被操作的实体类。BaseMapper 中已经实现许多的方法，直接使用即可。
2、配置日志
使用 mybatis-plus 的方法时，具体 sql 代码是不可见的，我们希望知道它是怎么执行的，就需要看日志。
# 配置日志
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl  # 这里使用 mybatis 自带的控制台输出
3、CRUD扩展
数据库的 user 表如下："><meta name=author content="lu"><link rel=canonical href=http://localhost:1313/posts/java/mybatisplus%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/><link crossorigin=anonymous href=/assets/css/stylesheet.d72444526d7ecbdb0015438a7fa89054a658bf759d0542e2e5df81ce94b493ee.css integrity="sha256-1yREUm1+y9sAFUOKf6iQVKZYv3WdBULi5d+BzpS0k+4=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/java/mybatisplus%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/posts/java/mybatisplus%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="lu"><meta property="og:title" content="MyBatisPlus学习笔记"><meta property="og:description" content="1、快速开始 1.1、导入依赖 mybatis 和 mybatis-plus 的依赖不要同时导入。
<dependencies> <dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter</artifactId> </dependency> <dependency> <groupId>mysql</groupId> <artifactId>mysql-connector-java</artifactId> <scope>runtime</scope> </dependency> <dependency> <groupId>com.baomidou</groupId> <artifactId>mybatis-plus-boot-starter</artifactId> <version>3.4.3</version> </dependency> <dependency> <groupId>com.baomidou</groupId> <artifactId>mybatis-plus-core</artifactId> <version>3.4.3</version> </dependency> <dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-web</artifactId> </dependency> <dependency> <groupId>org.projectlombok</groupId> <artifactId>lombok</artifactId> <optional>true</optional> </dependency> <dependency> <groupId>org.springframework.boot</groupId> <artifactId>spring-boot-starter-test</artifactId> <scope>test</scope> </dependency> </dependencies> 1.2、配置 在主yaml中配置和 mybatis 的完全一样，没其他配置。
1.3、使用 @Repository public interface UserMapper extends BaseMapper<User> { } UserMapper 接口只需继承 BaseMapper ，其中泛型填入被操作的实体类。BaseMapper 中已经实现许多的方法，直接使用即可。
2、配置日志 使用 mybatis-plus 的方法时，具体 sql 代码是不可见的，我们希望知道它是怎么执行的，就需要看日志。
# 配置日志 mybatis-plus: configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # 这里使用 mybatis 自带的控制台输出 3、CRUD扩展 数据库的 user 表如下："><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-18T19:42:15+00:00"><meta property="article:modified_time" content="2021-07-18T19:42:15+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="MyBatisPlus学习笔记"><meta name=twitter:description content="1、快速开始
1.1、导入依赖
mybatis 和 mybatis-plus 的依赖不要同时导入。
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter</artifactId>
    </dependency>

    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <scope>runtime</scope>
    </dependency>
    <dependency>
        <groupId>com.baomidou</groupId>
        <artifactId>mybatis-plus-boot-starter</artifactId>
        <version>3.4.3</version>
    </dependency>
    <dependency>
        <groupId>com.baomidou</groupId>
        <artifactId>mybatis-plus-core</artifactId>
        <version>3.4.3</version>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
1.2、配置
在主yaml中配置和 mybatis 的完全一样，没其他配置。
1.3、使用
@Repository
public interface UserMapper extends BaseMapper<User> {
}
UserMapper 接口只需继承 BaseMapper ，其中泛型填入被操作的实体类。BaseMapper 中已经实现许多的方法，直接使用即可。
2、配置日志
使用 mybatis-plus 的方法时，具体 sql 代码是不可见的，我们希望知道它是怎么执行的，就需要看日志。
# 配置日志
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl  # 这里使用 mybatis 自带的控制台输出
3、CRUD扩展
数据库的 user 表如下："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"MyBatisPlus学习笔记","item":"http://localhost:1313/posts/java/mybatisplus%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MyBatisPlus学习笔记","name":"MyBatisPlus学习笔记","description":"1、快速开始 1.1、导入依赖 mybatis 和 mybatis-plus 的依赖不要同时导入。\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.baomidou\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-plus-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.4.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.baomidou\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-plus-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.4.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; 1.2、配置 在主yaml中配置和 mybatis 的完全一样，没其他配置。\n1.3、使用 @Repository public interface UserMapper extends BaseMapper\u0026lt;User\u0026gt; { } UserMapper 接口只需继承 BaseMapper ，其中泛型填入被操作的实体类。BaseMapper 中已经实现许多的方法，直接使用即可。\n2、配置日志 使用 mybatis-plus 的方法时，具体 sql 代码是不可见的，我们希望知道它是怎么执行的，就需要看日志。\n# 配置日志 mybatis-plus: configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # 这里使用 mybatis 自带的控制台输出 3、CRUD扩展 数据库的 user 表如下：\n","keywords":[],"articleBody":"1、快速开始 1.1、导入依赖 mybatis 和 mybatis-plus 的依赖不要同时导入。\norg.springframework.boot spring-boot-starter mysql mysql-connector-java runtime com.baomidou mybatis-plus-boot-starter 3.4.3 com.baomidou mybatis-plus-core 3.4.3 org.springframework.boot spring-boot-starter-web org.projectlombok lombok true org.springframework.boot spring-boot-starter-test test 1.2、配置 在主yaml中配置和 mybatis 的完全一样，没其他配置。\n1.3、使用 @Repository public interface UserMapper extends BaseMapper\u003cUser\u003e { } UserMapper 接口只需继承 BaseMapper ，其中泛型填入被操作的实体类。BaseMapper 中已经实现许多的方法，直接使用即可。\n2、配置日志 使用 mybatis-plus 的方法时，具体 sql 代码是不可见的，我们希望知道它是怎么执行的，就需要看日志。\n# 配置日志 mybatis-plus: configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # 这里使用 mybatis 自带的控制台输出 3、CRUD扩展 数据库的 user 表如下：\nCREATE TABLE `user` ( `id` bigint NOT NULL AUTO_INCREMENT, `name` varchar(30) DEFAULT NULL, `age` int DEFAULT NULL, `email` varchar(30) DEFAULT NULL, `gmt_create` datetime DEFAULT NULL COMMENT '创建时间', `gmt_modified` datetime DEFAULT NULL COMMENT '更新时间', `version` int DEFAULT '1' COMMENT '乐观锁', `deleted` int DEFAULT '0' COMMENT '逻辑删除', PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 3.1、insert @Test void insert() { User user = new User(); user.setName(\"qin\"); user.setAge(18); user.setEmail(\"123456@163.com\"); int result = userMapper.insert(user); // 插入时自动生成id System.out.println(result); // 返回值为受影响的行数 System.out.println(user); // user 对象中 id 已经被自动生成 } 数据库插入的 id 默认值为： 全局唯一 id\n3.2、主键生成策略 分布式系统唯一ID生成方案汇总\nmybatis-plus 默认使用雪花算法生成主键。MybatisPlus主键生成策略\n@TableId(type = IdType.ASSIGN_ID) // 雪花算法。默认。 也可通过IdType.AUTO使用自增，此时数据库必须是自增 private Long id; // 必须是主键才能使用上行注解 private String name; 雪花算法（snowflake）是Twitter开源的分布式ID生成算法，结果是一个long型的ID。其核心思想是：第一bit是符号位，永远是0，无实际意义；接下来41bit作为毫秒数，10bit作为机器的ID（高5bit是数据中心，低5bit是工作节点ID），12bit作为毫秒内的流水号（意味着每个节点在每毫秒可以产生 4096 个 ID）。可以保证几乎全球唯一。\n3.3、update mybatis-plus 的方法使用了动态sql，因此若只想更新部分字段，则只需传入待更新字段即可。\n@Test void update() { User user = new User(); user.setId(1L); user.setName(\"xue\"); user.setAge(20); userMapper.updateById(user); // 根据主键ID，更新user的name和age，email不变则不需要传值 } 3.4、自动填充 数据表的创建时间，修改时间。这些操作都是自动化完成的，不希望手动更新。\n阿里开发手册：所有数据库表都要有 gmt_create 和 gmt_modified 字段，而且要自动化。（gmt：格林威治时间）\n方式一：数据库级别【工作中不允许使用这种方式】 1、在表中添加字段 gmt_create 和 gmt_modified ，数据类型为 datetime ，默认为 current_timestamp，gmt_modified 字段还需使其更新。\n2、在 entity 中添加上述两个属性，类型为 java.util.Date\n方式二：代码级别 1、在表中添加字段 gmt_create 和 gmt_modified ，数据类型为 datetime，DEFAULT 为 NULL。无需其他约束。\n2、在 entity 中的字段上添加注解\n@TableField(fill = FieldFill.INSERT) // 在插入时自动填充 private Date gmt_create; @TableField(fill = FieldFill.INSERT_UPDATE) // 在插入和更新时自动填充 private Date gmt_modified; 3、编写处理器处理注解（在 handler 包下创建如下类）\n@Component @Slf4j public class MyMetaObjectHandler implements MetaObjectHandler { // 插入时的填充策略 @Override public void insertFill(MetaObject metaObject) { log.info(\"start insert fill!\"); this.setFieldValByName(\"gmt_create\", new Date(), metaObject); this.setFieldValByName(\"gmt_modified\", new Date(), metaObject); } // 更新时的填充策略 @Override public void updateFill(MetaObject metaObject) { log.info(\"start update fill!\"); this.setFieldValByName(\"gmt_modified\", new Date(), metaObject); } } 3.5、乐观锁 乐观锁：总是认为不会出现问题，无论干什么都不会上锁，若出现问题再更新值测试。\n悲观锁：总是认为会出现问题，无论干什么都会上锁，再去操作。\n3.5.1、乐观锁实现方式：\n取出记录时，获取当前version 更新时，带上这个version 执行更新时， set version = newVersion where version = oldVersion 如果version不对，就更新失败 -- A 线程 update user set name = \"lu\", version = version + 1 where id = 2 and version = 1 -- 在 A 线程执行的过程中，B 线程执行下方语句，B 线程执行结束后 version = 2，导致线程 A 修改失败。 -- B 线程 update user set name = \"lu\", version = version + 1 where id = 2 and version = 1 3.5.2、mybatis-plus 的乐观锁插件\n1、数据表中添加 version 字段，int 类型、默认为 1。\n2、在 entity 中添加相应字段，并加上 Version注解\n@Version // 乐观锁 private Integer version; 3、注册组件（在 config 包下创建如下类）\n@MapperScan(\"com.example.mapper\") // 将扫描的任务从Application类中接过来 @EnableTransactionManagement // 自动管理事务 @Configuration public class MyBatisPlusConfig { @Bean public MybatisPlusInterceptor mybatisPlusInterceptor() { MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor(); // 注册乐观锁插件 interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor()); // 注册分页插件 interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.H2)); return interceptor; } } 4、测试\n// 模拟多线程下乐观锁使修改失效 @Test void testOptimisticLocker() { // 线程1 User user = userMapper.selectById(1L); user.setAge(23); // 模拟线程2执行插队操作 User user1 = userMapper.selectById(1L); user1.setAge(24); userMapper.updateById(user1); userMapper.updateById(user); // 若没有乐观锁，结果为23。但是有乐观锁后，线程1执行失败，结果为24 } 3.6、select @Test void select() { // 查询单个用户 User user = userMapper.selectById(1L); System.out.println(user); // 查询批量用户 List\u003cUser\u003e users = userMapper.selectBatchIds(Arrays.asList(1, 2, 3)); users.forEach(System.out::println); // 也可以使用userMapper.selectByMap();通过多个条件查询。不过一般不用这个，用 wrapper 。 } 3.7、分页查询 分页在网站使用的非常多。\n1、原始的 limit 分页\n2、pageHelper 第三方插件\n3、mybatis-plus 也内置了分页插件\n使用 mybatis-plus 的内置了分页插件：\n1、配置拦截器（在 config 包下创建如下类）\n@MapperScan(\"com.example.mapper\") // 将扫描的任务从Application类中接过来 @EnableTransactionManagement // 自动管理事务 @Configuration public class MyBatisPlusConfig { @Bean public MybatisPlusInterceptor mybatisPlusInterceptor() { MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor(); // 注册乐观锁插件 interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor()); // 注册分页插件 interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.H2)); return interceptor; } } 2、测试\n@Test void page() { // 参数一： 当前页 参数二：页面大小 // 当前页为 1 ，则查询结果为 1-5号；当前页为 2 ，则查询结果为 6-10号。 Page\u003cUser\u003e page = new Page\u003c\u003e(1, 5); userMapper.selectPage(page, null); page.getRecords().forEach(System.out::println); } 3.8、delete @Test void delete() { // 通过 id 删除单个用户 userMapper.deleteById(3); // 通过 id 删除批量用户 userMapper.deleteBatchIds(Arrays.asList(1, 2, 3)); // 通过 map 按条件删除用户 HashMap\u003cString, Object\u003e map = new HashMap\u003c\u003e(); map.put(\"name\", \"ya\"); map.put(\"age\", 18); userMapper.deleteByMap(map); } 3.9、逻辑删除 物理删除：从数据库中直接删除\n逻辑删除：数据库中不删除，只是通过一个变量让其失效（查询不到）\n逻辑删除相当于将数据放入回收站，防止数据丢失。\n使用逻辑删除：\n1、在数据库中添加一个字段 deleted，类型为 int ，默认为 0，注释为“逻辑删除”。当执行逻辑删除后其值变为1，即每次查询时都带上这个参数，只有其值为 0 的元组才能被返回。\n2、在 entity 中添加相应字段并加注释\n@TableLogic // 逻辑删除 private Integer deleted; 3、配置，在 application.yaml 中配置如下\nmybatis-plus: global-config: db-config: logic-delete-field: deleted # 全局逻辑删除的实体字段名(since 3.3.0,配置后可以忽略不配置步骤2) logic-delete-value: 1 # 逻辑已删除值(默认为 1) logic-not-delete-value: 0 # 逻辑未删除值(默认为 0) 4、测试\nuserMapper.deleteById(1L); 使用上方语句删除 1 号元素后，发现 sql 实际执行的是下方语句，该元素并没有被删除，只是 deleted 字段变为了1。\nUPDATE user SET deleted=1 WHERE id=1 AND deleted=0 上方语句执行完成后，再执行下方查询操作，查询结果为 null 。\nUser user = userMapper.selectById(1L); 实际 sql 的查询语句为：\nSELECT * FROM user WHERE id=1 AND deleted=0 3.10、性能分析插件 平时开发时会遇到一些慢 sql 。mybatis-plus 提供了性能分析插件，如果超过一定时间就会停止运行。\n作用：性能分析拦截器，用于输出每条 SQL 语句及其执行时间。\n1、导入 Maven\np6spy p6spy 最新版本 2、在 application.yaml 中将数据库连接的配置修改如下\n# 数据库连接 spring: datasource: username: root password: gaolu666 url: jdbc:p6spy:mysql://localhost:3306/mybatis?useSSL=false\u0026useUnicode=true\u0026characterEncoding=utf8\u0026serverTimezone=Asia/Shanghai driver-class-name: com.p6spy.engine.spy.P6SpyDriver 3、之后在涉及数据库操作时就会打印出 sql 语句和执行时间。\n3.11、条件构造器 @SpringBootTest public class WrapperTest { @Autowired private UserMapper userMapper; @Test void contextLoads() { QueryWrapper\u003cUser\u003e wrapper = new QueryWrapper\u003c\u003e(); // 实例化 wrapper wrapper.isNotNull(\"name\").isNotNull(\"email\").ge(\"age\", 21); // 链式编程；非空、\u003e= List\u003cUser\u003e users = userMapper.selectList(wrapper); // selectList 查询多个数据 users.forEach(System.out::println); // SELECT * FROM user WHERE deleted=0 AND (name IS NOT NULL AND email IS NOT NULL AND age \u003e= 21) } @Test void test() { QueryWrapper\u003cUser\u003e wrapper = new QueryWrapper\u003c\u003e(); wrapper.eq(\"name\", \"kui\"); // == User user = userMapper.selectOne(wrapper); // selectOne 查询一个数据 System.out.println(user); // SELECT * FROM user WHERE deleted=0 AND (name = 'kui') } @Test void test1() { QueryWrapper\u003cUser\u003e wrapper = new QueryWrapper\u003c\u003e(); wrapper.between(\"age\", 20, 30); // 20 到 30 的区间 Integer count = userMapper.selectCount(wrapper); // 满足条件的结果数量 System.out.println(count); // SELECT COUNT( * ) FROM user WHERE deleted=0 AND (age BETWEEN 20 AND 30) } @Test void test2() { QueryWrapper\u003cUser\u003e wrapper = new QueryWrapper\u003c\u003e(); wrapper.notLike(\"name\", \"y\").likeRight(\"email\", \"4\"); // 模糊查询 List\u003cMap\u003cString, Object\u003e\u003e maps = userMapper.selectMaps(wrapper); // 以键值对形式返回 maps.forEach(System.out::println); // SELECT * FROM user WHERE deleted=0 AND (name NOT LIKE '%y%' AND email LIKE '4%') } @Test void test3() { QueryWrapper\u003cUser\u003e wrapper = new QueryWrapper\u003c\u003e(); wrapper.inSql(\"id\", \"select id from user where age = 21\"); // 子查询 List\u003cObject\u003e objects = userMapper.selectObjs(wrapper); // 查对象 objects.forEach(System.out::println); // SELECT * FROM user WHERE deleted=0 AND (id IN (select id from user where age = 21)) } } 3.12、代码自动生成器 1、添加依赖\ncom.baomidou mybatis-plus-generator latest-version org.apache.velocity velocity-engine-core latest-version 2、新建 spring-boot 工程后，直接将下方类复制到 test 的目录下，执行即可。\npublic class AutoCode { public static void main(String[] args) { // 全局配置 GlobalConfig.Builder gcBuilder = new GlobalConfig.Builder(); // 更多全局配置看源码，不多 // 下行语句 获取工程根目录，此处为 E:\\programme_work\\java_work\\mybatis-plus String projectPath = System.getProperty(\"user.dir\") + \"/src/main/java\"; gcBuilder.outputDir(projectPath); // 生成的位置 gcBuilder.author(\"lu\"); gcBuilder.disableOpenDir(); // 是否打开生成文件的目录 // builder.enableSwagger(); // 开启 Swagger GlobalConfig gc = gcBuilder.build(); // 数据源配置 --\u003e 这里没有配置数据源驱动，不知道会不会报错 String url = \"jdbc:mysql://localhost:3306/mybatis?useSSL=false\u0026useUnicode=true\u0026characterEncoding=utf8\u0026serverTimezone=Asia/Shanghai\"; DataSourceConfig.Builder dsBuilder = new DataSourceConfig.Builder(url, \"root\", \"gaolu666\"); // .schema(\"schema name\") 用来配置 oracle 类型数据库的 schema， mysql 可以不写 DataSourceConfig dsc = dsBuilder.schema(\"schema name\").build(); // 包配置 PackageConfig.Builder pcBuilder = new PackageConfig.Builder(); pcBuilder.parent(\"com.lu\").moudleName(\"mybatis\"); PackageConfig pc = pcBuilder.build(); // 策略配置; lombok、自动填充、乐观锁等配置在 StrategyConfig 中的 Entity entity 属性配置，另外还有 service、mapper等的配置 StrategyConfig.Builder scBuilder = new StrategyConfig.Builder(); scBuilder.addInclude(\"user\"); // 设置要映射的表名，这里应该由控制台接收输入的表名 scBuilder.entityBuilder().enableLombok(); // 支持 lombok scBuilder.entityBuilder().enableTableFieldAnnotation(); // 支持 TableFieldAnnotation scBuilder.entityBuilder().naming(NamingStrategy.underlin_to_camel) // 下划线转驼峰 scBuilder.entityBuilder().columnNaming(NamingStrategy.underlin_to_camel) // 下划线转驼峰 scBuilder.entityBuilder().versionColumnName(\"version\"); // 乐观锁--数据库字段 scBuilder.entityBuilder().versionPropertyName(\"version\"); // 乐观锁--实体类属性 scBuilder.entityBuilder().logicDeleteColumnName(\"deleted\"); // 逻辑删除 scBuilder.entityBuilder().logicDeletePropertyName(\"deleted\");// 逻辑删除 // 自动填充 Column gmtCreateColumn = new Column(\"gmt_create\", FieldFill.INSERT); Column gmtModifiedColumn = new Column(\"gmt_modified\", FieldFill.INSERT_UPDATE); Property gmtCreateProperty = new Property(\"gmt_create\", FieldFill.INSERT); Property gmtModifiedProperty = new Property(\"gmt_modified\", FieldFill.INSERT_UPDATE); List\u003cIFill\u003e iFills = List.of(gmtCreateColumn, gmtCreateProperty, gmtModifiedColumn, gmtModifiedProperty); scBuilder.entityBuilder().addTableFills(iFills); scBuilder.controllerBuilder().enableRestStyle(); // RestController 风格 StrategyConfig sc = scBuilder.build(); // 代码生成器 AutoGenerator mpg = new AutoGenerator(dsc); mpg.global(gc); mpg.packageInfo(pc); mpg.strategy(sc); mpg.execute(new FreemarkerTemplateEngine()); // 执行 } } 3.13、Enum与Json 1、数据库中定义enum类型字段时，应用层也应该定义相应的枚举类，在枚举类中通过 @EnumValue和@JsonValue注解控制数据库存储字段和返回显示字段，两个注解可以添加到同一个变量。\n@Getter @AllArgsConstructor public enum UserStatusEnum { NORMAL(0, \"正常\"), FREEZE(1, \"冻结\"); // mybatis 通过该注解将枚举对象与数据库中的值进行转换 @EnumValue final Integer value; // springMVC 默认使用 jackson 处理返回结果，这里通过该注解将枚举对象的返回结果转换为该值 @JsonValue final String desc; } 2、数据库中定义Json类型字段时，应用层也应该定义相应类，类结构和Json类型结构相同。\n@Data public class UserInfo { private Integer age; private String gender; } 3、在实体对象中，Enum和Json字段都使用上方定义的类作为属性类型。Json类型字段需要添加类型处理器，并且在@TableName注解中添加自动结果映射；Enum类型字段在接收参数时，可以接收枚举类中的任意字段值。\n@Getter @Setter @EqualsAndHashCode(callSuper = false) // 对象内部嵌套了UserInfo对象，涉及对象嵌套就需要复杂的结果映射，这里使用 autoResultMap = true 自动进行结果映射 @TableName(value = \"user\", autoResultMap = true) public class User extends BaseDo { private static final long serialVersionUID = 1L; @TableId(value = \"id\", type = IdType.AUTO) private Long id; @TableField(\"username\") private String username; @TableField(\"password\") private String password; @TableField(\"phone\") private String phone; // 指定类型处理器，用于将对象映射为数据库的 json 格式 @TableField(value = \"info\", typeHandler = JacksonTypeHandler.class) private UserInfo info; @TableField(\"status\") private UserStatusEnum status; @TableField(\"balance\") private Integer balance; } ","wordCount":"1232","inLanguage":"en","datePublished":"2021-07-18T19:42:15Z","dateModified":"2021-07-18T19:42:15Z","author":{"@type":"Person","name":"lu"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/java/mybatisplus%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},"publisher":{"@type":"Organization","name":"lu","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/ title=categories><span>categories</span></a></li><li><a href=http://localhost:1313/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">MyBatisPlus学习笔记</h1><div class=post-meta><span title='2021-07-18 19:42:15 +0000 UTC'>2021-07-18</span>&nbsp;·&nbsp;1232 words&nbsp;·&nbsp;lu</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1快速开始>1、快速开始</a><ul><li><a href=#11导入依赖>1.1、导入依赖</a></li><li><a href=#12配置>1.2、配置</a></li><li><a href=#13使用>1.3、使用</a></li></ul></li><li><a href=#2配置日志>2、配置日志</a></li><li><a href=#3crud扩展>3、CRUD扩展</a><ul><li><a href=#31insert>3.1、insert</a></li><li><a href=#32主键生成策略>3.2、主键生成策略</a></li><li><a href=#33update>3.3、update</a></li><li><a href=#34自动填充>3.4、自动填充</a></li><li><a href=#35乐观锁>3.5、乐观锁</a></li><li><a href=#36select>3.6、select</a></li><li><a href=#37分页查询>3.7、分页查询</a></li><li><a href=#38delete>3.8、delete</a></li><li><a href=#39逻辑删除>3.9、逻辑删除</a></li><li><a href=#310性能分析插件>3.10、性能分析插件</a></li><li><a href=#311条件构造器>3.11、条件构造器</a></li><li><a href=#312代码自动生成器>3.12、代码自动生成器</a></li><li><a href=#313enum与json>3.13、Enum与Json</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=1快速开始>1、快速开始<a hidden class=anchor aria-hidden=true href=#1快速开始>#</a></h2><h3 id=11导入依赖>1.1、导入依赖<a hidden class=anchor aria-hidden=true href=#11导入依赖>#</a></h3><p>mybatis 和 mybatis-plus 的依赖不要同时导入。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>mysql<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>mysql-connector-java<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;scope&gt;</span>runtime<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>com.baomidou<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>mybatis-plus-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;version&gt;</span>3.4.3<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>com.baomidou<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>mybatis-plus-core<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;version&gt;</span>3.4.3<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>lombok<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;optional&gt;</span>true<span style=color:#f92672>&lt;/optional&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-test<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;scope&gt;</span>test<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span></code></pre></div><h3 id=12配置>1.2、配置<a hidden class=anchor aria-hidden=true href=#12配置>#</a></h3><p>在主yaml中配置和 mybatis 的完全一样，没其他配置。</p><h3 id=13使用>1.3、使用<a hidden class=anchor aria-hidden=true href=#13使用>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Repository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapper</span> <span style=color:#66d9ef>extends</span> BaseMapper<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>UserMapper 接口只需继承 BaseMapper ，其中泛型填入被操作的实体类。BaseMapper 中已经实现许多的方法，直接使用即可。</p><h2 id=2配置日志>2、配置日志<a hidden class=anchor aria-hidden=true href=#2配置日志>#</a></h2><p>使用 mybatis-plus 的方法时，具体 sql 代码是不可见的，我们希望知道它是怎么执行的，就需要看日志。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 配置日志</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mybatis-plus</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>configuration</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>log-impl</span>: <span style=color:#ae81ff>org.apache.ibatis.logging.stdout.StdOutImpl </span> <span style=color:#75715e># 这里使用 mybatis 自带的控制台输出</span>
</span></span></code></pre></div><h2 id=3crud扩展>3、CRUD扩展<a hidden class=anchor aria-hidden=true href=#3crud扩展>#</a></h2><p>数据库的 user 表如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span><span style=color:#66d9ef>user</span><span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>id<span style=color:#f92672>`</span> bigint <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> AUTO_INCREMENT,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>30</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>age<span style=color:#f92672>`</span> int <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>email<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>30</span>) <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>gmt_create<span style=color:#f92672>`</span> datetime <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;创建时间&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>gmt_modified<span style=color:#f92672>`</span> datetime <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;更新时间&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span><span style=color:#66d9ef>version</span><span style=color:#f92672>`</span> int <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;乐观锁&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>deleted<span style=color:#f92672>`</span> int <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#66d9ef>COMMENT</span> <span style=color:#e6db74>&#39;逻辑删除&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (<span style=color:#f92672>`</span>id<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span>) ENGINE<span style=color:#f92672>=</span>InnoDB <span style=color:#66d9ef>DEFAULT</span> CHARSET<span style=color:#f92672>=</span>utf8mb4
</span></span></code></pre></div><h3 id=31insert>3.1、insert<a hidden class=anchor aria-hidden=true href=#31insert>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>insert</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    User user <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User();
</span></span><span style=display:flex><span>    user.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#34;qin&#34;</span>);
</span></span><span style=display:flex><span>    user.<span style=color:#a6e22e>setAge</span>(18);
</span></span><span style=display:flex><span>    user.<span style=color:#a6e22e>setEmail</span>(<span style=color:#e6db74>&#34;123456@163.com&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> result <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>insert</span>(user);  <span style=color:#75715e>// 插入时自动生成id</span>
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(result);            <span style=color:#75715e>// 返回值为受影响的行数</span>
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(user);              <span style=color:#75715e>// user 对象中 id 已经被自动生成</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>数据库插入的 id 默认值为： 全局唯一 id</p><h3 id=32主键生成策略>3.2、主键生成策略<a hidden class=anchor aria-hidden=true href=#32主键生成策略>#</a></h3><p><a href=https://www.cnblogs.com/haoxinyue/p/5208136.html>分布式系统唯一ID生成方案汇总</a></p><p>mybatis-plus 默认使用雪花算法生成主键。<a href=https://zhuanlan.zhihu.com/p/163056279>MybatisPlus主键生成策略</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@TableId</span>(type <span style=color:#f92672>=</span> IdType.<span style=color:#a6e22e>ASSIGN_ID</span>)   <span style=color:#75715e>// 雪花算法。默认。 也可通过IdType.AUTO使用自增，此时数据库必须是自增</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Long id;                    <span style=color:#75715e>// 必须是主键才能使用上行注解</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> String name;
</span></span></code></pre></div><p>雪花算法（snowflake）是Twitter开源的分布式ID生成算法，结果是一个long型的ID。其核心思想是：第一bit是符号位，永远是0，无实际意义；接下来41bit作为毫秒数，10bit作为机器的ID（高5bit是数据中心，低5bit是工作节点ID），12bit作为毫秒内的流水号（意味着每个节点在每毫秒可以产生 4096 个 ID）。可以保证几乎全球唯一。</p><h3 id=33update>3.3、update<a hidden class=anchor aria-hidden=true href=#33update>#</a></h3><p>mybatis-plus 的方法使用了动态sql，因此若只想更新部分字段，则只需传入待更新字段即可。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>update</span>() {
</span></span><span style=display:flex><span>    User user <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User();
</span></span><span style=display:flex><span>    user.<span style=color:#a6e22e>setId</span>(1L);
</span></span><span style=display:flex><span>    user.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#34;xue&#34;</span>);
</span></span><span style=display:flex><span>    user.<span style=color:#a6e22e>setAge</span>(20);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    userMapper.<span style=color:#a6e22e>updateById</span>(user);  <span style=color:#75715e>// 根据主键ID，更新user的name和age，email不变则不需要传值</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=34自动填充>3.4、自动填充<a hidden class=anchor aria-hidden=true href=#34自动填充>#</a></h3><p>数据表的创建时间，修改时间。这些操作都是自动化完成的，不希望手动更新。</p><p>阿里开发手册：所有数据库表都要有 gmt_create 和 gmt_modified 字段，而且要自动化。（gmt：格林威治时间）</p><ul><li>方式一：数据库级别【工作中不允许使用这种方式】</li></ul><p>1、在表中添加字段 gmt_create 和 gmt_modified ，数据类型为 datetime ，默认为 current_timestamp，gmt_modified 字段还需使其更新。</p><p>2、在 entity 中添加上述两个属性，类型为 java.util.Date</p><ul><li><strong>方式二</strong>：代码级别</li></ul><p>1、在表中添加字段 gmt_create 和 gmt_modified ，数据类型为 datetime，DEFAULT 为 NULL。无需其他约束。</p><p>2、在 entity 中的字段上添加注解</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@TableField</span>(fill <span style=color:#f92672>=</span> FieldFill.<span style=color:#a6e22e>INSERT</span>)          <span style=color:#75715e>// 在插入时自动填充</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Date gmt_create;
</span></span><span style=display:flex><span><span style=color:#a6e22e>@TableField</span>(fill <span style=color:#f92672>=</span> FieldFill.<span style=color:#a6e22e>INSERT_UPDATE</span>)   <span style=color:#75715e>// 在插入和更新时自动填充</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Date gmt_modified;
</span></span></code></pre></div><p>3、编写处理器处理注解（在 handler 包下创建如下类）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyMetaObjectHandler</span> <span style=color:#66d9ef>implements</span> MetaObjectHandler {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 插入时的填充策略</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>insertFill</span>(MetaObject metaObject) {
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;start insert fill!&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setFieldValByName</span>(<span style=color:#e6db74>&#34;gmt_create&#34;</span>, <span style=color:#66d9ef>new</span> Date(), metaObject);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setFieldValByName</span>(<span style=color:#e6db74>&#34;gmt_modified&#34;</span>, <span style=color:#66d9ef>new</span> Date(), metaObject);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 更新时的填充策略</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>updateFill</span>(MetaObject metaObject) {
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;start update fill!&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setFieldValByName</span>(<span style=color:#e6db74>&#34;gmt_modified&#34;</span>, <span style=color:#66d9ef>new</span> Date(), metaObject);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=35乐观锁>3.5、乐观锁<a hidden class=anchor aria-hidden=true href=#35乐观锁>#</a></h3><ul><li><p>乐观锁：总是认为不会出现问题，无论干什么都不会上锁，若出现问题再更新值测试。</p></li><li><p>悲观锁：总是认为会出现问题，无论干什么都会上锁，再去操作。</p></li></ul><p>3.5.1、乐观锁实现方式：</p><ul><li>取出记录时，获取当前version</li><li>更新时，带上这个version</li><li>执行更新时， set version = newVersion where version = oldVersion</li><li>如果version不对，就更新失败</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- A 线程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>set</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lu&#34;</span>, <span style=color:#66d9ef>version</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>version</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>version</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- 在 A 线程执行的过程中，B 线程执行下方语句，B 线程执行结束后 version = 2，导致线程 A 修改失败。
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- B 线程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>set</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lu&#34;</span>, <span style=color:#66d9ef>version</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>version</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>version</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>3.5.2、mybatis-plus 的乐观锁插件</p><p>1、数据表中添加 version 字段，int 类型、默认为 1。</p><p>2、在 entity 中添加相应字段，并加上 Version注解</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Version</span>  <span style=color:#75715e>// 乐观锁</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Integer version;
</span></span></code></pre></div><p>3、注册组件（在 config 包下创建如下类）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@MapperScan</span>(<span style=color:#e6db74>&#34;com.example.mapper&#34;</span>)  <span style=color:#75715e>// 将扫描的任务从Application类中接过来</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableTransactionManagement</span>   <span style=color:#75715e>// 自动管理事务</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyBatisPlusConfig</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> MybatisPlusInterceptor <span style=color:#a6e22e>mybatisPlusInterceptor</span>() {
</span></span><span style=display:flex><span>        MybatisPlusInterceptor interceptor <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MybatisPlusInterceptor();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 注册乐观锁插件</span>
</span></span><span style=display:flex><span>        interceptor.<span style=color:#a6e22e>addInnerInterceptor</span>(<span style=color:#66d9ef>new</span> OptimisticLockerInnerInterceptor());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 注册分页插件</span>
</span></span><span style=display:flex><span>        interceptor.<span style=color:#a6e22e>addInnerInterceptor</span>(<span style=color:#66d9ef>new</span> PaginationInnerInterceptor(DbType.<span style=color:#a6e22e>H2</span>));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> interceptor;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>4、测试</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 模拟多线程下乐观锁使修改失效</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testOptimisticLocker</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 线程1</span>
</span></span><span style=display:flex><span>    User user <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>selectById</span>(1L);
</span></span><span style=display:flex><span>    user.<span style=color:#a6e22e>setAge</span>(23);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 模拟线程2执行插队操作</span>
</span></span><span style=display:flex><span>    User user1 <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>selectById</span>(1L);
</span></span><span style=display:flex><span>    user1.<span style=color:#a6e22e>setAge</span>(24);
</span></span><span style=display:flex><span>    userMapper.<span style=color:#a6e22e>updateById</span>(user1);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    userMapper.<span style=color:#a6e22e>updateById</span>(user);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 若没有乐观锁，结果为23。但是有乐观锁后，线程1执行失败，结果为24</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=36select>3.6、select<a hidden class=anchor aria-hidden=true href=#36select>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>select</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//  查询单个用户</span>
</span></span><span style=display:flex><span>    User user <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>selectById</span>(1L);
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(user);
</span></span><span style=display:flex><span>    <span style=color:#75715e>//  查询批量用户</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> users <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>selectBatchIds</span>(Arrays.<span style=color:#a6e22e>asList</span>(1, 2, 3));
</span></span><span style=display:flex><span>    users.<span style=color:#a6e22e>forEach</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 也可以使用userMapper.selectByMap();通过多个条件查询。不过一般不用这个，用 wrapper 。</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=37分页查询>3.7、分页查询<a hidden class=anchor aria-hidden=true href=#37分页查询>#</a></h3><p>分页在网站使用的非常多。</p><p>1、原始的 limit 分页</p><p>2、pageHelper 第三方插件</p><p>3、mybatis-plus 也内置了分页插件</p><p>使用 mybatis-plus 的内置了分页插件：</p><p>1、配置拦截器（在 config 包下创建如下类）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@MapperScan</span>(<span style=color:#e6db74>&#34;com.example.mapper&#34;</span>)  <span style=color:#75715e>// 将扫描的任务从Application类中接过来</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableTransactionManagement</span>   <span style=color:#75715e>// 自动管理事务</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyBatisPlusConfig</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> MybatisPlusInterceptor <span style=color:#a6e22e>mybatisPlusInterceptor</span>() {
</span></span><span style=display:flex><span>        MybatisPlusInterceptor interceptor <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MybatisPlusInterceptor();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 注册乐观锁插件</span>
</span></span><span style=display:flex><span>        interceptor.<span style=color:#a6e22e>addInnerInterceptor</span>(<span style=color:#66d9ef>new</span> OptimisticLockerInnerInterceptor());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 注册分页插件</span>
</span></span><span style=display:flex><span>        interceptor.<span style=color:#a6e22e>addInnerInterceptor</span>(<span style=color:#66d9ef>new</span> PaginationInnerInterceptor(DbType.<span style=color:#a6e22e>H2</span>));
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> interceptor;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>2、测试</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>page</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 参数一： 当前页     参数二：页面大小</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 当前页为 1 ，则查询结果为 1-5号；当前页为 2 ，则查询结果为 6-10号。</span>
</span></span><span style=display:flex><span>    Page<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> page <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Page<span style=color:#f92672>&lt;&gt;</span>(1, 5);
</span></span><span style=display:flex><span>    userMapper.<span style=color:#a6e22e>selectPage</span>(page, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    page.<span style=color:#a6e22e>getRecords</span>().<span style=color:#a6e22e>forEach</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=38delete>3.8、delete<a hidden class=anchor aria-hidden=true href=#38delete>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>delete</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 通过 id 删除单个用户</span>
</span></span><span style=display:flex><span>    userMapper.<span style=color:#a6e22e>deleteById</span>(3);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 通过 id 删除批量用户</span>
</span></span><span style=display:flex><span>    userMapper.<span style=color:#a6e22e>deleteBatchIds</span>(Arrays.<span style=color:#a6e22e>asList</span>(1, 2, 3));
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 通过 map 按条件删除用户</span>
</span></span><span style=display:flex><span>    HashMap<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>    map.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;ya&#34;</span>);
</span></span><span style=display:flex><span>    map.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;age&#34;</span>, 18);
</span></span><span style=display:flex><span>    userMapper.<span style=color:#a6e22e>deleteByMap</span>(map);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=39逻辑删除>3.9、逻辑删除<a hidden class=anchor aria-hidden=true href=#39逻辑删除>#</a></h3><ul><li><p>物理删除：从数据库中直接删除</p></li><li><p>逻辑删除：数据库中不删除，只是通过一个变量让其失效（查询不到）</p></li></ul><p>逻辑删除相当于将数据放入回收站，防止数据丢失。</p><p>使用逻辑删除：</p><p>1、在数据库中添加一个字段 deleted，类型为 int ，默认为 0，注释为“逻辑删除”。当执行逻辑删除后其值变为1，即每次查询时都带上这个参数，只有其值为 0 的元组才能被返回。</p><p>2、在 entity 中添加相应字段并加注释</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@TableLogic</span>  <span style=color:#75715e>// 逻辑删除</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> Integer deleted;
</span></span></code></pre></div><p>3、配置，在 application.yaml 中配置如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>mybatis-plus</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>global-config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>db-config</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>logic-delete-field</span>: <span style=color:#ae81ff>deleted </span> <span style=color:#75715e># 全局逻辑删除的实体字段名(since 3.3.0,配置后可以忽略不配置步骤2)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>logic-delete-value</span>: <span style=color:#ae81ff>1</span> <span style=color:#75715e># 逻辑已删除值(默认为 1)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>logic-not-delete-value</span>: <span style=color:#ae81ff>0</span> <span style=color:#75715e># 逻辑未删除值(默认为 0)</span>
</span></span></code></pre></div><p>4、测试</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>userMapper.<span style=color:#a6e22e>deleteById</span>(1L);
</span></span></code></pre></div><p>使用上方语句删除 1 号元素后，发现 sql 实际执行的是下方语句，该元素并没有被删除，只是 deleted 字段变为了1。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>SET</span> deleted<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> deleted<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>上方语句执行完成后，再执行下方查询操作，查询结果为 null 。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>User user <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>selectById</span>(1L);
</span></span></code></pre></div><p>实际 sql 的查询语句为：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>user</span> <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> deleted<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h3 id=310性能分析插件>3.10、性能分析插件<a hidden class=anchor aria-hidden=true href=#310性能分析插件>#</a></h3><p>平时开发时会遇到一些慢 sql 。mybatis-plus 提供了性能分析插件，如果超过一定时间就会停止运行。</p><p>作用：性能分析拦截器，用于输出每条 SQL 语句及其执行时间。</p><p>1、导入 Maven</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;groupId&gt;</span>p6spy<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;artifactId&gt;</span>p6spy<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;version&gt;</span>最新版本<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>2、在 application.yaml 中将数据库连接的配置修改如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 数据库连接</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>datasource</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>username</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>password</span>: <span style=color:#ae81ff>gaolu666</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#ae81ff>jdbc:p6spy:mysql://localhost:3306/mybatis?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>driver-class-name</span>: <span style=color:#ae81ff>com.p6spy.engine.spy.P6SpyDriver</span>
</span></span></code></pre></div><p>3、之后在涉及数据库操作时就会打印出 sql 语句和执行时间。</p><h3 id=311条件构造器>3.11、条件构造器<a hidden class=anchor aria-hidden=true href=#311条件构造器>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WrapperTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserMapper userMapper;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>contextLoads</span>() {
</span></span><span style=display:flex><span>        QueryWrapper<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> wrapper <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> QueryWrapper<span style=color:#f92672>&lt;&gt;</span>();   <span style=color:#75715e>// 实例化 wrapper</span>
</span></span><span style=display:flex><span>        wrapper.<span style=color:#a6e22e>isNotNull</span>(<span style=color:#e6db74>&#34;name&#34;</span>).<span style=color:#a6e22e>isNotNull</span>(<span style=color:#e6db74>&#34;email&#34;</span>).<span style=color:#a6e22e>ge</span>(<span style=color:#e6db74>&#34;age&#34;</span>, 21);   <span style=color:#75715e>// 链式编程；非空、&gt;=</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> users <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>selectList</span>(wrapper);    <span style=color:#75715e>// selectList  查询多个数据</span>
</span></span><span style=display:flex><span>        users.<span style=color:#a6e22e>forEach</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// SELECT * FROM user WHERE deleted=0 AND (name IS NOT NULL AND email IS NOT NULL AND age &gt;= 21)</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test</span>() {
</span></span><span style=display:flex><span>        QueryWrapper<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> wrapper <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> QueryWrapper<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        wrapper.<span style=color:#a6e22e>eq</span>(<span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;kui&#34;</span>);    <span style=color:#75715e>// ==</span>
</span></span><span style=display:flex><span>        User user <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>selectOne</span>(wrapper);    <span style=color:#75715e>// selectOne  查询一个数据</span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(user);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// SELECT * FROM user WHERE deleted=0 AND (name = &#39;kui&#39;)</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test1</span>() {
</span></span><span style=display:flex><span>        QueryWrapper<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> wrapper <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> QueryWrapper<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        wrapper.<span style=color:#a6e22e>between</span>(<span style=color:#e6db74>&#34;age&#34;</span>, 20, 30);   <span style=color:#75715e>// 20 到 30 的区间</span>
</span></span><span style=display:flex><span>        Integer count <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>selectCount</span>(wrapper);   <span style=color:#75715e>// 满足条件的结果数量</span>
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(count);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// SELECT COUNT( * ) FROM user WHERE deleted=0 AND (age BETWEEN 20 AND 30)</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test2</span>() {
</span></span><span style=display:flex><span>        QueryWrapper<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> wrapper <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> QueryWrapper<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        wrapper.<span style=color:#a6e22e>notLike</span>(<span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;y&#34;</span>).<span style=color:#a6e22e>likeRight</span>(<span style=color:#e6db74>&#34;email&#34;</span>, <span style=color:#e6db74>&#34;4&#34;</span>);  <span style=color:#75715e>// 模糊查询</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;&gt;</span> maps <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>selectMaps</span>(wrapper);   <span style=color:#75715e>// 以键值对形式返回</span>
</span></span><span style=display:flex><span>        maps.<span style=color:#a6e22e>forEach</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// SELECT * FROM user WHERE deleted=0 AND (name NOT LIKE &#39;%y%&#39; AND email LIKE &#39;4%&#39;)</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test3</span>() {
</span></span><span style=display:flex><span>        QueryWrapper<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> wrapper <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> QueryWrapper<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        wrapper.<span style=color:#a6e22e>inSql</span>(<span style=color:#e6db74>&#34;id&#34;</span>, <span style=color:#e6db74>&#34;select id from user where age = 21&#34;</span>);   <span style=color:#75715e>// 子查询</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>Object<span style=color:#f92672>&gt;</span> objects <span style=color:#f92672>=</span> userMapper.<span style=color:#a6e22e>selectObjs</span>(wrapper);   <span style=color:#75715e>// 查对象</span>
</span></span><span style=display:flex><span>        objects.<span style=color:#a6e22e>forEach</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// SELECT * FROM user WHERE deleted=0 AND (id IN (select id from user where age = 21))</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=312代码自动生成器>3.12、代码自动生成器<a hidden class=anchor aria-hidden=true href=#312代码自动生成器>#</a></h3><p>1、添加依赖</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.baomidou<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>mybatis-plus-generator<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>latest-version<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.velocity<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>velocity-engine-core<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>latest-version<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>2、新建 spring-boot 工程后，直接将下方类复制到 test 的目录下，执行即可。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AutoCode</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 全局配置</span>
</span></span><span style=display:flex><span>        GlobalConfig.<span style=color:#a6e22e>Builder</span> gcBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GlobalConfig.<span style=color:#a6e22e>Builder</span>();
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 更多全局配置看源码，不多</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 下行语句 获取工程根目录，此处为 E:\programme_work\java_work\mybatis-plus</span>
</span></span><span style=display:flex><span>        String projectPath <span style=color:#f92672>=</span> System.<span style=color:#a6e22e>getProperty</span>(<span style=color:#e6db74>&#34;user.dir&#34;</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/src/main/java&#34;</span>;
</span></span><span style=display:flex><span>        gcBuilder.<span style=color:#a6e22e>outputDir</span>(projectPath);  <span style=color:#75715e>// 生成的位置</span>
</span></span><span style=display:flex><span>        gcBuilder.<span style=color:#a6e22e>author</span>(<span style=color:#e6db74>&#34;lu&#34;</span>);
</span></span><span style=display:flex><span>        gcBuilder.<span style=color:#a6e22e>disableOpenDir</span>();   <span style=color:#75715e>// 是否打开生成文件的目录</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// builder.enableSwagger();  // 开启 Swagger</span>
</span></span><span style=display:flex><span>        GlobalConfig gc <span style=color:#f92672>=</span> gcBuilder.<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 数据源配置  --&gt;  这里没有配置数据源驱动，不知道会不会报错</span>
</span></span><span style=display:flex><span>        String url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;jdbc:mysql://localhost:3306/mybatis?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai&#34;</span>;
</span></span><span style=display:flex><span>        DataSourceConfig.<span style=color:#a6e22e>Builder</span> dsBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DataSourceConfig.<span style=color:#a6e22e>Builder</span>(url, <span style=color:#e6db74>&#34;root&#34;</span>, <span style=color:#e6db74>&#34;gaolu666&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// .schema(&#34;schema name&#34;) 用来配置 oracle 类型数据库的 schema， mysql 可以不写</span>
</span></span><span style=display:flex><span>        DataSourceConfig dsc <span style=color:#f92672>=</span> dsBuilder.<span style=color:#a6e22e>schema</span>(<span style=color:#e6db74>&#34;schema name&#34;</span>).<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 包配置</span>
</span></span><span style=display:flex><span>        PackageConfig.<span style=color:#a6e22e>Builder</span> pcBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PackageConfig.<span style=color:#a6e22e>Builder</span>();
</span></span><span style=display:flex><span>        pcBuilder.<span style=color:#a6e22e>parent</span>(<span style=color:#e6db74>&#34;com.lu&#34;</span>).<span style=color:#a6e22e>moudleName</span>(<span style=color:#e6db74>&#34;mybatis&#34;</span>);
</span></span><span style=display:flex><span>        PackageConfig pc <span style=color:#f92672>=</span> pcBuilder.<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 策略配置;  lombok、自动填充、乐观锁等配置在 StrategyConfig 中的 Entity entity 属性配置，另外还有 service、mapper等的配置</span>
</span></span><span style=display:flex><span>        StrategyConfig.<span style=color:#a6e22e>Builder</span> scBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StrategyConfig.<span style=color:#a6e22e>Builder</span>();
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>addInclude</span>(<span style=color:#e6db74>&#34;user&#34;</span>);   <span style=color:#75715e>// 设置要映射的表名，这里应该由控制台接收输入的表名</span>
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>entityBuilder</span>().<span style=color:#a6e22e>enableLombok</span>();  <span style=color:#75715e>// 支持 lombok</span>
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>entityBuilder</span>().<span style=color:#a6e22e>enableTableFieldAnnotation</span>();  <span style=color:#75715e>// 支持 TableFieldAnnotation</span>
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>entityBuilder</span>().<span style=color:#a6e22e>naming</span>(NamingStrategy.<span style=color:#a6e22e>underlin_to_camel</span>) <span style=color:#75715e>// 下划线转驼峰</span>
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>entityBuilder</span>().<span style=color:#a6e22e>columnNaming</span>(NamingStrategy.<span style=color:#a6e22e>underlin_to_camel</span>) <span style=color:#75715e>// 下划线转驼峰</span>
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>entityBuilder</span>().<span style=color:#a6e22e>versionColumnName</span>(<span style=color:#e6db74>&#34;version&#34;</span>);   <span style=color:#75715e>// 乐观锁--数据库字段</span>
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>entityBuilder</span>().<span style=color:#a6e22e>versionPropertyName</span>(<span style=color:#e6db74>&#34;version&#34;</span>);   <span style=color:#75715e>// 乐观锁--实体类属性</span>
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>entityBuilder</span>().<span style=color:#a6e22e>logicDeleteColumnName</span>(<span style=color:#e6db74>&#34;deleted&#34;</span>);  <span style=color:#75715e>// 逻辑删除</span>
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>entityBuilder</span>().<span style=color:#a6e22e>logicDeletePropertyName</span>(<span style=color:#e6db74>&#34;deleted&#34;</span>);<span style=color:#75715e>// 逻辑删除</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 自动填充</span>
</span></span><span style=display:flex><span>        Column gmtCreateColumn <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Column(<span style=color:#e6db74>&#34;gmt_create&#34;</span>, FieldFill.<span style=color:#a6e22e>INSERT</span>);
</span></span><span style=display:flex><span>        Column gmtModifiedColumn <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Column(<span style=color:#e6db74>&#34;gmt_modified&#34;</span>, FieldFill.<span style=color:#a6e22e>INSERT_UPDATE</span>);
</span></span><span style=display:flex><span>        Property gmtCreateProperty <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Property(<span style=color:#e6db74>&#34;gmt_create&#34;</span>, FieldFill.<span style=color:#a6e22e>INSERT</span>);
</span></span><span style=display:flex><span>        Property gmtModifiedProperty <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Property(<span style=color:#e6db74>&#34;gmt_modified&#34;</span>, FieldFill.<span style=color:#a6e22e>INSERT_UPDATE</span>);
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>IFill<span style=color:#f92672>&gt;</span> iFills <span style=color:#f92672>=</span> List.<span style=color:#a6e22e>of</span>(gmtCreateColumn, gmtCreateProperty, gmtModifiedColumn, gmtModifiedProperty);
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>entityBuilder</span>().<span style=color:#a6e22e>addTableFills</span>(iFills);
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        scBuilder.<span style=color:#a6e22e>controllerBuilder</span>().<span style=color:#a6e22e>enableRestStyle</span>();  <span style=color:#75715e>// RestController 风格</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        StrategyConfig sc <span style=color:#f92672>=</span> scBuilder.<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 代码生成器</span>
</span></span><span style=display:flex><span>        AutoGenerator mpg <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> AutoGenerator(dsc);
</span></span><span style=display:flex><span>        mpg.<span style=color:#a6e22e>global</span>(gc);
</span></span><span style=display:flex><span>        mpg.<span style=color:#a6e22e>packageInfo</span>(pc);
</span></span><span style=display:flex><span>        mpg.<span style=color:#a6e22e>strategy</span>(sc);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        mpg.<span style=color:#a6e22e>execute</span>(<span style=color:#66d9ef>new</span> FreemarkerTemplateEngine());   <span style=color:#75715e>// 执行</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=313enum与json>3.13、Enum与Json<a hidden class=anchor aria-hidden=true href=#313enum与json>#</a></h3><p>1、数据库中定义enum类型字段时，应用层也应该定义相应的枚举类，在枚举类中通过 <code>@EnumValue</code>和<code>@JsonValue</code>注解控制数据库存储字段和返回显示字段，两个注解可以添加到同一个变量。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Getter</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>enum</span> UserStatusEnum {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    NORMAL(0, <span style=color:#e6db74>&#34;正常&#34;</span>),
</span></span><span style=display:flex><span>    FREEZE(1, <span style=color:#e6db74>&#34;冻结&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// mybatis 通过该注解将枚举对象与数据库中的值进行转换</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@EnumValue</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>final</span> Integer value;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// springMVC 默认使用 jackson 处理返回结果，这里通过该注解将枚举对象的返回结果转换为该值</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@JsonValue</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>final</span> String desc;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>2、数据库中定义Json类型字段时，应用层也应该定义相应类，类结构和Json类型结构相同。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserInfo</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer age;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gender;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>3、在实体对象中，Enum和Json字段都使用上方定义的类作为属性类型。Json类型字段需要添加类型处理器，并且在<code>@TableName</code>注解中添加自动结果映射；Enum类型字段在接收参数时，可以接收枚举类中的任意字段值。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Getter</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Setter</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EqualsAndHashCode</span>(callSuper <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// 对象内部嵌套了UserInfo对象，涉及对象嵌套就需要复杂的结果映射，这里使用 autoResultMap = true 自动进行结果映射</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@TableName</span>(value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;user&#34;</span>, autoResultMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>extends</span> BaseDo {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> serialVersionUID <span style=color:#f92672>=</span> 1L;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@TableId</span>(value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;id&#34;</span>, type <span style=color:#f92672>=</span> IdType.<span style=color:#a6e22e>AUTO</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@TableField</span>(<span style=color:#e6db74>&#34;username&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String username;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@TableField</span>(<span style=color:#e6db74>&#34;password&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String password;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@TableField</span>(<span style=color:#e6db74>&#34;phone&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String phone;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 指定类型处理器，用于将对象映射为数据库的 json 格式</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@TableField</span>(value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;info&#34;</span>, typeHandler <span style=color:#f92672>=</span> JacksonTypeHandler.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserInfo info;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@TableField</span>(<span style=color:#e6db74>&#34;status&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> UserStatusEnum status;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@TableField</span>(<span style=color:#e6db74>&#34;balance&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer balance;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/java/shiro%E7%AC%94%E8%AE%B0/><span class=title>« Prev</span><br><span>Shrio学习笔记</span>
</a><a class=next href=http://localhost:1313/posts/java/jvm%E7%AC%94%E8%AE%B0/><span class=title>Next »</span><br><span>JVM学习笔记</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>lu</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>